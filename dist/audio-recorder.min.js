/*! audio-recorder-widget v1.0.0 | MIT License */
!function(e){"use strict";var t="audioRecorder_selectedDevice",AudioRecorder=function(e){this.options=this._extend({container:null,maxDuration:300,sampleRate:44100,bitRate:128,format:"wav",flashPath:"flash/recorder.swf",onStart:function(){},onStop:function(){},onPause:function(){},onResume:function(){},onData:function(){},onError:function(){},onPermissionGranted:function(){},onPermissionDenied:function(){},onDeviceChange:function(){},theme:"dark",variant:"standard",showPause:!0,showPlay:!0,showDownload:!0,showTimer:!0,showStatus:!0,showSettings:!0,liveVisualization:!0},e||{}),this.isRecording=!1,this.isPaused=!1,this.duration=0,this.audioContext=null,this.mediaStream=null,this.mediaRecorder=null,this.audioChunks=[],this.selectedDeviceId=this._loadDeviceFromStorage(),this.audioDevices=[],this.recordingMode=null,this.timerInterval=null,this.analyser=null,this.dataArray=null,this.animationFrame=null,this.previewStream=null,this.previewAnimationFrame=null,this.previewAnalyser=null,this.previewDataArray=null,this._detectCapabilities(),this._init()};AudioRecorder.prototype._extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},AudioRecorder.prototype._detectCapabilities=function(){var t=navigator;this.hasMediaRecorder="undefined"!=typeof MediaRecorder,this.hasGetUserMedia=!(!t.mediaDevices||!t.mediaDevices.getUserMedia),this.hasLegacyGetUserMedia=!!(t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia),this.hasAudioContext=!(!e.AudioContext&&!e.webkitAudioContext),this.hasFlash=this._detectFlash(),this.hasMediaRecorder&&this.hasGetUserMedia?this.recordingMode="mediarecorder":this.hasAudioContext&&(this.hasGetUserMedia||this.hasLegacyGetUserMedia)?this.recordingMode="webaudio":this.hasFlash?this.recordingMode="flash":this.recordingMode="none"},AudioRecorder.prototype._detectFlash=function(){var e=!1;try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(e=!0)}return e},AudioRecorder.prototype._init=function(){if(!this.options.container)throw new Error("AudioRecorder: container option is required");var e="string"==typeof this.options.container?document.querySelector(this.options.container):this.options.container;if(!e)throw new Error("AudioRecorder: container element not found");this.container=e,this._createUI(),this._bindEvents(),"flash"===this.recordingMode&&this._initFlash()},AudioRecorder.prototype._createUI=function(){var e=this.options,t="mini"===e.variant,i="minimal"===e.variant,s="button"===e.variant,a="standard"!==e.variant?" ar-variant-"+e.variant:"",n=['<div class="ar-recorder ar-theme-'+e.theme+a+'">'];s?(n.push('  <div class="ar-button-wrapper">'),n.push('    <button class="ar-btn-single" type="button" title="Click to record">'),n.push('      <div class="ar-btn-single-icon">'),n.push('        <svg class="ar-icon-mic" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>'),n.push('        <svg class="ar-icon-stop" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="1"/></svg>'),n.push("      </div>"),n.push('      <div class="ar-btn-single-content">'),n.push('        <span class="ar-btn-single-label">Record</span>'),n.push('        <span class="ar-btn-single-timer">00:00</span>'),n.push("      </div>"),n.push('      <div class="ar-btn-single-level"><div class="ar-btn-single-level-bar"></div></div>'),n.push("    </button>"),e.showSettings&&(n.push('    <div class="ar-settings-wrapper">'),n.push('      <button class="ar-btn ar-btn-settings" type="button" title="Audio Settings">'),n.push('        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>'),n.push("      </button>"),n.push('      <div class="ar-settings-panel">'),n.push('        <div class="ar-settings-header">'),n.push("          <span>Audio Input</span>"),n.push('          <button class="ar-settings-close" type="button">&times;</button>'),n.push("        </div>"),n.push('        <div class="ar-settings-content">'),n.push('          <select class="ar-device-select"><option value="">Default Microphone</option></select>'),n.push("        </div>"),n.push("      </div>"),n.push("    </div>")),n.push("  </div>")):t?(n.push('  <div class="ar-mini-wrapper">'),n.push('    <div class="ar-level-indicator"><div class="ar-level-bar"></div></div>')):i||(n.push('  <div class="ar-visualizer">'),n.push('    <canvas class="ar-canvas"></canvas>'),e.showStatus&&n.push('    <div class="ar-status"><span class="ar-status-text">Ready</span></div>'),e.showSettings&&(n.push('    <div class="ar-settings-wrapper ar-settings-overlay">'),n.push('      <button class="ar-btn ar-btn-settings" type="button" title="Audio Settings">'),n.push('        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>'),n.push("      </button>"),n.push('      <div class="ar-settings-panel">'),n.push('        <div class="ar-settings-header">'),n.push("          <span>Audio Input</span>"),n.push('          <button class="ar-settings-close" type="button">&times;</button>'),n.push("        </div>"),n.push('        <div class="ar-settings-content">'),n.push('          <select class="ar-device-select"><option value="">Default Microphone</option></select>'),n.push("        </div>"),n.push("      </div>"),n.push("    </div>")),n.push("  </div>")),s||(e.showTimer&&!t&&n.push('  <div class="ar-timer">00:00</div>'),n.push('  <div class="ar-controls">'),n.push('    <button class="ar-btn ar-btn-record" type="button" title="Record">'),n.push('      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg>'),n.push("    </button>"),e.showPause&&(n.push('    <button class="ar-btn ar-btn-pause" type="button" title="Pause" disabled>'),n.push('      <svg viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>'),n.push("    </button>")),n.push('    <button class="ar-btn ar-btn-stop" type="button" title="Stop" disabled>'),n.push('      <svg viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"/></svg>'),n.push("    </button>"),e.showPlay&&(n.push('    <button class="ar-btn ar-btn-play" type="button" title="Play" disabled>'),n.push('      <svg viewBox="0 0 24 24"><polygon points="6,4 20,12 6,20"/></svg>'),n.push("    </button>")),e.showDownload&&(n.push('    <button class="ar-btn ar-btn-download" type="button" title="Download" disabled>'),n.push('      <svg viewBox="0 0 24 24"><path d="M12 16l-6-6h4V4h4v6h4l-6 6z"/><path d="M4 18h16v2H4z"/></svg>'),n.push("    </button>")),e.showSettings&&(t||i)&&(n.push('    <div class="ar-settings-wrapper">'),n.push('      <button class="ar-btn ar-btn-settings" type="button" title="Audio Settings">'),n.push('        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>'),n.push("      </button>"),n.push('      <div class="ar-settings-panel">'),n.push('        <div class="ar-settings-header">'),n.push("          <span>Audio Input</span>"),n.push('          <button class="ar-settings-close" type="button">&times;</button>'),n.push("        </div>"),n.push('        <div class="ar-settings-content">'),n.push('          <select class="ar-device-select"><option value="">Default Microphone</option></select>'),n.push("        </div>"),n.push("      </div>"),n.push("    </div>")),n.push("  </div>"),t&&(e.showTimer&&n.push('    <div class="ar-timer ar-mini-timer">00:00</div>'),n.push("  </div>"))),n.push('  <div class="ar-flash-container"></div>'),n.push('  <div class="ar-error"></div>'),n.push("</div>"),this.container.innerHTML=n.join("\n"),this.elements={recorder:this.container.querySelector(".ar-recorder"),canvas:this.container.querySelector(".ar-canvas"),timer:this.container.querySelector(".ar-timer"),status:this.container.querySelector(".ar-status-text"),btnRecord:this.container.querySelector(".ar-btn-record"),btnPause:this.container.querySelector(".ar-btn-pause"),btnStop:this.container.querySelector(".ar-btn-stop"),btnPlay:this.container.querySelector(".ar-btn-play"),btnDownload:this.container.querySelector(".ar-btn-download"),btnSettings:this.container.querySelector(".ar-btn-settings"),settingsPanel:this.container.querySelector(".ar-settings-panel"),settingsClose:this.container.querySelector(".ar-settings-close"),deviceSelect:this.container.querySelector(".ar-device-select"),flashContainer:this.container.querySelector(".ar-flash-container"),error:this.container.querySelector(".ar-error"),levelIndicator:this.container.querySelector(".ar-level-indicator"),levelBar:this.container.querySelector(".ar-level-bar"),btnSingle:this.container.querySelector(".ar-btn-single"),btnSingleLabel:this.container.querySelector(".ar-btn-single-label"),btnSingleTimer:this.container.querySelector(".ar-btn-single-timer"),btnSingleLevelBar:this.container.querySelector(".ar-btn-single-level-bar")},this.elements.canvas&&(this.canvasCtx=this.elements.canvas.getContext("2d"),this._resizeCanvas(),this._drawIdleVisualization(),this.options.liveVisualization&&this._startPreviewVisualization()),!this.options.liveVisualization||"mini"!==this.options.variant&&"button"!==this.options.variant||this._startPreviewVisualization()},AudioRecorder.prototype._loadDeviceFromStorage=function(){try{return localStorage.getItem(t)||null}catch(e){return null}},AudioRecorder.prototype._saveDeviceToStorage=function(e){try{e?localStorage.setItem(t,e):localStorage.removeItem(t)}catch(e){}},AudioRecorder.prototype._startPreviewVisualization=function(){var t=this;if(!this.isRecording&&!this.previewStream&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var i={audio:!this.selectedDeviceId||{deviceId:{exact:this.selectedDeviceId}}};navigator.mediaDevices.getUserMedia(i).then(function(i){if(t.isRecording)i.getTracks().forEach(function(e){e.stop()});else{t.previewStream=i;var s=e.AudioContext||e.webkitAudioContext;s&&(t.audioContext||(t.audioContext=new s),t.previewAnalyser=t.audioContext.createAnalyser(),t.previewAnalyser.fftSize=256,t.audioContext.createMediaStreamSource(i).connect(t.previewAnalyser),t.previewDataArray=new Uint8Array(t.previewAnalyser.frequencyBinCount),t._visualizePreview())}}).catch(function(e){t.selectedDeviceId&&(t.selectedDeviceId=null,t._saveDeviceToStorage(null),t._startPreviewVisualization())})}},AudioRecorder.prototype._stopPreviewVisualization=function(){this.previewAnimationFrame&&(cancelAnimationFrame(this.previewAnimationFrame),this.previewAnimationFrame=null),this.previewStream&&(this.previewStream.getTracks().forEach(function(e){e.stop()}),this.previewStream=null),this.previewAnalyser=null,this.previewDataArray=null},AudioRecorder.prototype._visualizePreview=function(){var e=this;!this.isRecording&&this.previewStream&&(this.previewAnimationFrame=requestAnimationFrame(function(){e._visualizePreview()}),this.previewAnalyser&&this.previewAnalyser.getByteFrequencyData(this.previewDataArray),"mini"===this.options.variant?this._updateLevelIndicatorPreview():"button"===this.options.variant?this._updateButtonLevelPreview():this.elements.canvas&&this.canvasCtx&&this._drawPreviewVisualization())},AudioRecorder.prototype._updateLevelIndicatorPreview=function(){if(this.elements.levelBar&&this.previewDataArray){for(var e=0,t=0;t<this.previewDataArray.length;t++)e+=this.previewDataArray[t];var i=e/this.previewDataArray.length,s=Math.min(100,i/128*100);this.elements.levelBar.style.width=s+"%"}},AudioRecorder.prototype._updateButtonLevelPreview=function(){if(this.elements.btnSingleLevelBar&&this.previewDataArray){for(var e=0,t=0;t<this.previewDataArray.length;t++)e+=this.previewDataArray[t];var i=e/this.previewDataArray.length,s=Math.min(100,i/128*100);this.elements.btnSingleLevelBar.style.width=s+"%"}},AudioRecorder.prototype._drawPreviewVisualization=function(){var e=this.elements.canvas,t=this.canvasCtx,i=e.width,s=e.height,a="dark"===this.options.theme;if(t.fillStyle=a?"#1a1a2e":"#ffffff",t.fillRect(0,0,i,s),this.previewDataArray)for(var n=i/this.previewDataArray.length*2.5,o=0,r=0;r<this.previewDataArray.length;r++){var l=this.previewDataArray[r]/255*s*.8,d=t.createLinearGradient(0,s-l,0,s);d.addColorStop(0,"#48dbfb"),d.addColorStop(1,a?"rgba(72, 219, 251, 0.3)":"rgba(72, 219, 251, 0.5)"),t.fillStyle=d,t.fillRect(o,s-l,n-1,l),o+=n+1}},AudioRecorder.prototype._resizeCanvas=function(){var e=this.elements.canvas.parentElement.getBoundingClientRect();this.elements.canvas.width=e.width||300,this.elements.canvas.height=e.height||80},AudioRecorder.prototype._bindEvents=function(){var t=this;this.elements.btnSingle&&this.elements.btnSingle.addEventListener("click",function(){t.isRecording?t.stop():t.start()}),this.elements.btnRecord&&this.elements.btnRecord.addEventListener("click",function(){t.start()}),this.elements.btnPause&&this.elements.btnPause.addEventListener("click",function(){t.isPaused?t.resume():t.pause()}),this.elements.btnStop&&this.elements.btnStop.addEventListener("click",function(){t.stop()}),this.elements.btnPlay&&this.elements.btnPlay.addEventListener("click",function(){t.play()}),this.elements.btnDownload&&this.elements.btnDownload.addEventListener("click",function(){t.download()}),this.elements.btnSettings&&this.elements.btnSettings.addEventListener("click",function(e){e.stopPropagation(),t._toggleSettings()}),this.elements.settingsClose&&this.elements.settingsClose.addEventListener("click",function(){t._hideSettings()}),this.elements.deviceSelect&&this.elements.deviceSelect.addEventListener("change",function(){t._selectDevice(this.value)}),document.addEventListener("click",function(e){!t.elements.settingsPanel||!t.elements.settingsPanel.classList.contains("ar-visible")||t.elements.settingsPanel.contains(e.target)||t.elements.btnSettings&&t.elements.btnSettings.contains(e.target)||t._hideSettings()}),e.addEventListener("resize",function(){t.elements.canvas&&(t._resizeCanvas(),t.isRecording||t._drawIdleVisualization())})},AudioRecorder.prototype._initFlash=function(){var t=this,i="ar-flash-"+Date.now();e["AudioRecorderFlashCallback_"+i]={ready:function(){t._flashReady=!0},data:function(e){t._handleFlashData(e)},error:function(e){t._showError(e)}};var s=['<object id="'+i+'" type="application/x-shockwave-flash" ','data="'+this.options.flashPath+'" width="1" height="1">','<param name="movie" value="'+this.options.flashPath+'"/>','<param name="allowScriptAccess" value="always"/>','<param name="FlashVars" value="callback=AudioRecorderFlashCallback_'+i+'"/>',"</object>"].join("");this.elements.flashContainer.innerHTML=s,this._flashObject=document.getElementById(i)},AudioRecorder.prototype.start=function(){if(!this.isRecording)if(this._stopPreviewVisualization(),this._setStatus("Requesting permission..."),this.audioChunks=[],this.duration=0,"mediarecorder"===this.recordingMode)this._startMediaRecorder();else if("webaudio"===this.recordingMode)this._startWebAudio();else{if("flash"!==this.recordingMode)return void this._showError("Audio recording is not supported in this browser");this._startFlash()}},AudioRecorder.prototype._startMediaRecorder=function(){var e=this,t={audio:!this.selectedDeviceId||{deviceId:{exact:this.selectedDeviceId}}};navigator.mediaDevices.getUserMedia(t).then(function(t){e.mediaStream=t,e.options.onPermissionGranted();var i=e._getSupportedMimeType(),s=i?{mimeType:i}:{};e.mediaRecorder=new MediaRecorder(t,s),e.mediaRecorder.ondataavailable=function(t){t.data.size>0&&e.audioChunks.push(t.data)},e.mediaRecorder.onstop=function(){e._processRecording()},e.mediaRecorder.start(100),e._onRecordingStarted(t)}).catch(function(t){e.options.onPermissionDenied(),e._showError("Permission denied: "+t.message)})},AudioRecorder.prototype._getSupportedMimeType=function(){for(var e=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/wav"],t=0;t<e.length;t++)if(MediaRecorder.isTypeSupported(e[t]))return e[t];return null},AudioRecorder.prototype._startWebAudio=function(){var e=this,t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,i={audio:!this.selectedDeviceId||{deviceId:{exact:this.selectedDeviceId}}};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(i).then(function(t){e._initWebAudioRecording(t)}).catch(function(t){e.options.onPermissionDenied(),e._showError("Permission denied: "+t.message)}):t&&t.call(navigator,{audio:!0},function(t){e._initWebAudioRecording(t)},function(t){e.options.onPermissionDenied(),e._showError("Permission denied: "+t.message)})},AudioRecorder.prototype._initWebAudioRecording=function(t){var i=this,s=e.AudioContext||e.webkitAudioContext;this.mediaStream=t,this.audioContext=new s,this.options.onPermissionGranted();var a=this.audioContext.createMediaStreamSource(t),n=this.audioContext.createScriptProcessor(4096,1,1);this._audioBuffers=[],n.onaudioprocess=function(e){if(i.isRecording&&!i.isPaused){var t=e.inputBuffer.getChannelData(0);i._audioBuffers.push(new Float32Array(t))}},a.connect(n),n.connect(this.audioContext.destination),this._audioProcessor=n,this._audioSource=a,this._onRecordingStarted(t)},AudioRecorder.prototype._startFlash=function(){if(this._flashReady)try{this._flashObject.startRecording(),this._onRecordingStarted(null)}catch(e){this._showError("Flash recording failed: "+e.message)}else this._showError("Flash is not ready. Please wait or enable Flash.")},AudioRecorder.prototype._onRecordingStarted=function(e){this.isRecording=!0,this.isPaused=!1,this._setStatus("Recording"),this._updateButtons("recording"),this.elements.recorder.classList.add("ar-recording"),this.elements.btnSingle&&(this.elements.btnSingle.classList.add("ar-btn-single-recording"),this.elements.btnSingleLabel&&(this.elements.btnSingleLabel.textContent="Stop")),this._startTimer(),e&&this.hasAudioContext?this._initVisualization(e):"mini"!==this.options.variant&&"button"!==this.options.variant&&this.elements.canvas&&this._drawRecordingVisualization(),this.options.onStart()},AudioRecorder.prototype._initVisualization=function(t){var i=e.AudioContext||e.webkitAudioContext;this.audioContext||(this.audioContext=new i),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.audioContext.createMediaStreamSource(t).connect(this.analyser),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this._visualize()},AudioRecorder.prototype._visualize=function(){var e=this;this.isRecording&&(this.animationFrame=requestAnimationFrame(function(){e._visualize()}),this.analyser&&this.analyser.getByteFrequencyData(this.dataArray),"mini"===this.options.variant||"button"===this.options.variant?this._updateLevelIndicator():this.elements.canvas&&this._drawVisualization())},AudioRecorder.prototype._updateLevelIndicator=function(){if(this.dataArray){for(var e=0,t=0;t<this.dataArray.length;t++)e+=this.dataArray[t];var i,s=e/this.dataArray.length,a=Math.min(100,s/255*150);i=a>70?"#ff6b6b":a>40?"#feca57":"#48dbfb",this.elements.levelBar&&(this.elements.levelBar.style.width=a+"%",this.elements.levelBar.style.background=i),this.elements.btnSingleLevelBar&&(this.elements.btnSingleLevelBar.style.width=a+"%",this.elements.btnSingleLevelBar.style.background=i)}},AudioRecorder.prototype._drawVisualization=function(){var e=this.elements.canvas,t=this.canvasCtx,i=e.width,s=e.height,a="dark"===this.options.theme;if(t.fillStyle=a?"#1a1a2e":"#f8f9fa",t.fillRect(0,0,i,s),this.dataArray){var n,o=i/this.dataArray.length*2.5,r=0,l=t.createLinearGradient(0,s,0,0);l.addColorStop(0,"#ff6b6b"),l.addColorStop(.5,"#feca57"),l.addColorStop(1,"#48dbfb");for(var d=0;d<this.dataArray.length;d++)n=this.dataArray[d]/255*s*.9,t.fillStyle=l,t.beginPath(),t.moveTo(r+2,s-n),t.lineTo(r+o-2,s-n),t.quadraticCurveTo(r+o,s-n,r+o,s-n+2),t.lineTo(r+o,s),t.lineTo(r,s),t.lineTo(r,s-n+2),t.quadraticCurveTo(r,s-n,r+2,s-n),t.fill(),r+=o+1}},AudioRecorder.prototype._drawIdleVisualization=function(){var e=this.elements.canvas,t=this.canvasCtx,i=e.width,s=e.height,a="dark"===this.options.theme;t.fillStyle=a?"#1a1a2e":"#f8f9fa",t.fillRect(0,0,i,s),t.strokeStyle=a?"#2d2d44":"#e9ecef",t.lineWidth=2,t.beginPath(),t.moveTo(0,s/2),t.lineTo(i,s/2),t.stroke()},AudioRecorder.prototype._drawRecordingVisualization=function(){var e=this,t=this.elements.canvas,i=this.canvasCtx,s=t.width,a=t.height,n="dark"===this.options.theme,o=0;!function t(){if(e.isRecording){e.animationFrame=requestAnimationFrame(t),o+=.05,i.fillStyle=n?"#1a1a2e":"#f8f9fa",i.fillRect(0,0,s,a),i.strokeStyle="#ff6b6b",i.lineWidth=2,i.beginPath();for(var r=0;r<s;r++){var l=a/2+20*Math.sin(.02*r+o)*Math.sin(.5*o);0===r?i.moveTo(r,l):i.lineTo(r,l)}i.stroke()}}()},AudioRecorder.prototype._startTimer=function(){var e=this;this.timerInterval=setInterval(function(){e.isPaused||(e.duration++,e._updateTimer(),e.duration>=e.options.maxDuration&&e.stop())},1e3)},AudioRecorder.prototype._updateTimer=function(){var e=Math.floor(this.duration/60),t=this.duration%60,i=(e<10?"0":"")+e+":"+(t<10?"0":"")+t;this.elements.timer&&(this.elements.timer.textContent=i),this.elements.btnSingleTimer&&(this.elements.btnSingleTimer.textContent=i)},AudioRecorder.prototype.pause=function(){this.isRecording&&!this.isPaused&&(this.isPaused=!0,this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.pause(),"flash"===this.recordingMode&&this._flashObject&&this._flashObject.pauseRecording(),this._setStatus("Paused"),this._updateButtons("paused"),this.elements.recorder.classList.add("ar-paused"),this.options.onPause())},AudioRecorder.prototype.resume=function(){this.isRecording&&this.isPaused&&(this.isPaused=!1,this.mediaRecorder&&"paused"===this.mediaRecorder.state&&this.mediaRecorder.resume(),"flash"===this.recordingMode&&this._flashObject&&this._flashObject.resumeRecording(),this._setStatus("Recording"),this._updateButtons("recording"),this.elements.recorder.classList.remove("ar-paused"),this.options.onResume())},AudioRecorder.prototype.stop=function(){this.isRecording&&(this.isRecording=!1,this.isPaused=!1,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),"webaudio"===this.recordingMode&&this._processWebAudioRecording(),"flash"===this.recordingMode&&this._flashObject&&this._flashObject.stopRecording(),this.mediaStream&&this.mediaStream.getTracks().forEach(function(e){e.stop()}),this._setStatus("Processing..."),this.elements.recorder.classList.remove("ar-recording","ar-paused"),this.options.onStop())},AudioRecorder.prototype._processRecording=function(){var e=this.mediaRecorder&&this.mediaRecorder.mimeType?this.mediaRecorder.mimeType:"audio/webm";this.recordedBlob=new Blob(this.audioChunks,{type:e}),this.recordedUrl=URL.createObjectURL(this.recordedBlob),this._setStatus("Ready to play"),this._updateButtons("stopped"),this.elements.canvas&&this._drawIdleVisualization(),this._resetLevelIndicator(),this._resetButtonUI(),this.options.liveVisualization&&this._startPreviewVisualization(),this.options.onData({blob:this.recordedBlob,url:this.recordedUrl,duration:this.duration})},AudioRecorder.prototype._resetButtonUI=function(){this.elements.btnSingle&&(this.elements.btnSingle.classList.remove("ar-btn-single-recording"),this.elements.btnSingleLabel&&(this.elements.btnSingleLabel.textContent="Record"))},AudioRecorder.prototype._resetLevelIndicator=function(){this.elements.levelBar&&(this.elements.levelBar.style.width="0%",this.elements.levelBar.style.background="#48dbfb"),this.elements.btnSingleLevelBar&&(this.elements.btnSingleLevelBar.style.width="0%",this.elements.btnSingleLevelBar.style.background="#48dbfb")},AudioRecorder.prototype._processWebAudioRecording=function(){if(this._audioBuffers&&0!==this._audioBuffers.length){for(var e=0,t=0;t<this._audioBuffers.length;t++)e+=this._audioBuffers[t].length;var i=new Float32Array(e),s=0;for(t=0;t<this._audioBuffers.length;t++)i.set(this._audioBuffers[t],s),s+=this._audioBuffers[t].length;var a=this._encodeWAV(i,this.audioContext.sampleRate);this.recordedBlob=a,this.recordedUrl=URL.createObjectURL(a),this._audioProcessor&&this._audioProcessor.disconnect(),this._audioSource&&this._audioSource.disconnect(),this._setStatus("Ready to play"),this._updateButtons("stopped"),this.elements.canvas&&this._drawIdleVisualization(),this._resetLevelIndicator(),this._resetButtonUI(),this.options.liveVisualization&&this._startPreviewVisualization(),this.options.onData({blob:this.recordedBlob,url:this.recordedUrl,duration:this.duration})}else this._showError("No audio data recorded")},AudioRecorder.prototype._encodeWAV=function(e,t){var i=new ArrayBuffer(44+2*e.length),s=new DataView(i);function a(e,t,i){for(var s=0;s<i.length;s++)e.setUint8(t+s,i.charCodeAt(s))}a(s,0,"RIFF"),s.setUint32(4,36+2*e.length,!0),a(s,8,"WAVE"),a(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,t,!0),s.setUint32(28,2*t,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),a(s,36,"data"),s.setUint32(40,2*e.length,!0);for(var n=44,o=0;o<e.length;o++){var r=Math.max(-1,Math.min(1,e[o]));s.setInt16(n,r<0?32768*r:32767*r,!0),n+=2}return new Blob([i],{type:"audio/wav"})},AudioRecorder.prototype._handleFlashData=function(e){for(var t=atob(e),i=new Uint8Array(t.length),s=0;s<t.length;s++)i[s]=t.charCodeAt(s);this.recordedBlob=new Blob([i],{type:"audio/wav"}),this.recordedUrl=URL.createObjectURL(this.recordedBlob),this._setStatus("Ready to play"),this._updateButtons("stopped"),this.options.onData({blob:this.recordedBlob,url:this.recordedUrl,duration:this.duration})},AudioRecorder.prototype.play=function(){var e=this;this.recordedUrl&&(this._audioElement&&this._audioElement.pause(),this._audioElement=new Audio(this.recordedUrl),this._audioElement.onplay=function(){e._setStatus("Playing"),e.elements.btnPlay&&e.elements.btnPlay.classList.add("ar-playing")},this._audioElement.onended=function(){e._setStatus("Ready to play"),e.elements.btnPlay&&e.elements.btnPlay.classList.remove("ar-playing")},this._audioElement.play())},AudioRecorder.prototype.download=function(e){if(this.recordedBlob){var t=e||"recording-"+Date.now(),i=this.recordedBlob.type.split("/")[1]||"wav";i.indexOf(";")>-1&&(i=i.split(";")[0]);var s=document.createElement("a");s.href=this.recordedUrl,s.download=t+"."+i,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},AudioRecorder.prototype.getBlob=function(){return this.recordedBlob||null},AudioRecorder.prototype.getUrl=function(){return this.recordedUrl||null},AudioRecorder.prototype.getDuration=function(){return this.duration},AudioRecorder.prototype.reset=function(){this.audioChunks=[],this.duration=0,this.recordedUrl&&URL.revokeObjectURL(this.recordedUrl),this.recordedBlob=null,this.recordedUrl=null,this._updateTimer(),this._setStatus("Ready"),this._updateButtons("idle"),this.elements.canvas&&this._drawIdleVisualization(),this._resetLevelIndicator(),this._resetButtonUI(),this.options.liveVisualization&&this._startPreviewVisualization()},AudioRecorder.prototype.destroy=function(){this._stopPreviewVisualization(),this.stop(),this.reset(),this.audioContext&&this.audioContext.close(),this.container.innerHTML=""},AudioRecorder.prototype._updateButtons=function(e){var t=this.elements;t.btnRecord&&(t.btnRecord.disabled="idle"!==e&&"stopped"!==e),t.btnStop&&(t.btnStop.disabled="recording"!==e&&"paused"!==e),t.btnPause&&(t.btnPause.disabled="recording"!==e&&"paused"!==e,"paused"===e?(t.btnPause.classList.add("ar-active"),t.btnPause.title="Resume"):(t.btnPause.classList.remove("ar-active"),t.btnPause.title="Pause")),t.btnPlay&&(t.btnPlay.disabled="stopped"!==e),t.btnDownload&&(t.btnDownload.disabled="stopped"!==e)},AudioRecorder.prototype._toggleSettings=function(){this.elements.settingsPanel.classList.contains("ar-visible")?this._hideSettings():this._showSettings()},AudioRecorder.prototype._showSettings=function(){this.elements.settingsPanel.classList.add("ar-visible"),this._loadDevices()},AudioRecorder.prototype._hideSettings=function(){this.elements.settingsPanel.classList.remove("ar-visible")},AudioRecorder.prototype._loadDevices=function(){var e=this;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(t){e.audioDevices=t.filter(function(e){return"audioinput"===e.kind});var i=e.selectedDeviceId,s=i&&e.audioDevices.some(function(e){return e.deviceId===i});i&&!s&&(e.selectedDeviceId=null,e._saveDeviceToStorage(null));var a=e.elements.deviceSelect,n=e.selectedDeviceId||"";a.innerHTML='<option value="">Default Microphone</option>',e.audioDevices.forEach(function(e,t){var i=document.createElement("option");i.value=e.deviceId,i.textContent=e.label||"Microphone "+(t+1),e.deviceId===n&&(i.selected=!0),a.appendChild(i)})}).catch(function(e){console.warn("Could not enumerate audio devices:",e)}):console.warn("enumerateDevices not supported")},AudioRecorder.prototype._selectDevice=function(e){this.selectedDeviceId=e||null,this._saveDeviceToStorage(e),this.options.onDeviceChange(e,this._getSelectedDeviceLabel()),this._hideSettings(),this.options.liveVisualization&&!this.isRecording&&(this._stopPreviewVisualization(),this._startPreviewVisualization())},AudioRecorder.prototype._getSelectedDeviceLabel=function(){if(!this.selectedDeviceId)return"Default Microphone";var e=this.audioDevices.find(function(e){return e.deviceId===this.selectedDeviceId}.bind(this));return e?e.label||"Microphone":"Default Microphone"},AudioRecorder.prototype.getSelectedDevice=function(){return{deviceId:this.selectedDeviceId,label:this._getSelectedDeviceLabel()}},AudioRecorder.prototype.setDevice=function(e){this.selectedDeviceId=e||null},AudioRecorder.prototype._setStatus=function(e){this.elements.status&&(this.elements.status.textContent=e)},AudioRecorder.prototype._showError=function(e){this.elements.error.textContent=e,this.elements.error.style.display="block",this.options.onError(e);var t=this;setTimeout(function(){t.elements.error.style.display="none"},5e3)},AudioRecorder.isSupported=function(){var t=navigator,i="undefined"!=typeof MediaRecorder,s=(!t.mediaDevices||t.mediaDevices.getUserMedia,t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia,!(!e.AudioContext&&!e.webkitAudioContext)),a=!1;try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(a=!0)}catch(e){t.mimeTypes&&void 0!==t.mimeTypes["application/x-shockwave-flash"]&&t.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(a=!0)}return i||s||a},AudioRecorder.getCapabilities=function(){return{mediaRecorder:"undefined"!=typeof MediaRecorder,getUserMedia:!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),legacyGetUserMedia:!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),audioContext:!(!e.AudioContext&&!e.webkitAudioContext),flash:AudioRecorder.prototype._detectFlash.call({})}},"undefined"!=typeof module&&module.exports?module.exports=AudioRecorder:"function"==typeof define&&define.amd?define(function(){return AudioRecorder}):e.AudioRecorder=AudioRecorder}("undefined"!=typeof window?window:this);